# Makefile Written by ticktick

# Show how to cross-compile c/c++ code for android platform

.PHONY: clean

CC = gcc
CXX = g++
AR = ar
LD = ld
STRIP = strip
WALL = -Wall

CUR_DIR = $(shell pwd)

CFLAGS =
TARGET_DIR = $(CUR_DIR)/hex/
TARGET_NAME = qchttpd
TARGET = $(TARGET_DIR)$(TARGET_NAME)
		

SRC_DIR = $(CUR_DIR)/src

OBJ_DIR = $(CUR_DIR)/obj

SRC_ID_FILE = $(SRC_DIR)/id.h

VERSION?="V1.0"

ID?="default000000"
PLATFORMS?="undowndev"
DEBUG_ON?="0"

$(shell rm -rf $(SRC_ID_FILE))
$(shell sync)
$(shell touch $(SRC_ID_FILE))
$(shell echo "#ifndef __ID_H__" >> $(SRC_ID_FILE))
$(shell echo "#define __ID_H__" >> $(SRC_ID_FILE))

$(shell echo >> $(SRC_ID_FILE))
$(shell echo "#define ID             \"$(ID)\"" >> $(SRC_ID_FILE))

$(shell echo >> $(SRC_ID_FILE))
$(shell echo "#define PLATFORMS      \"$(PLATFORMS)\"" >> $(SRC_ID_FILE))

$(shell echo >> $(SRC_ID_FILE))
$(shell echo "#define MODULE_NAME	 \"$(TARGET_NAME)\"" >> $(SRC_ID_FILE))

#$(shell echo >> $(SRC_ID_FILE))
#$(shell echo "#define DEBUG_ON	     $(DEBUG_ON)" >> $(SRC_ID_FILE))

$(shell echo >> $(SRC_ID_FILE))
#
$(shell echo >> $(SRC_ID_FILE))
$(shell echo "#endif" >> $(SRC_ID_FILE))
$(shell sync)
	
#获取当前目录下所有的.c文件
SOURCE = $(wildcard $(SRC_DIR)/*.c)

# -lssl -lcrypto -ldl   -lssl -lcrypto -ldl   -L$(CUR_DIR)/lib 

#得到相应的.o文件,所有的.c文件替换为.o文件
OBJ = $(patsubst %.c,$(OBJ_DIR)/%.o,$(notdir $(SOURCE)))

#-gstabs  $(LIB_INC) -ggdb3 -lssl -lcrypto -ldl 
$(OBJ_DIR)/%.o:$(SRC_DIR)/%.c
	@echo "$(CHAIN_TOOL)-gcc $<"
	@$(CC) -ggdb $(WALL) $< -c -o $@ -lpthread

#生成目标的依赖 -lssl -lcrypto -ldl 
$(TARGET): $(OBJ) $(OBJ_CPP)
	@echo "--------------create $(TARGET)---------"
	@$(CC) $(WALL) -o $@ $^ -lpthread
	@$(STRIP) $(TARGET)
	ls -alh $(TARGET_DIR) | grep $(TARGET_NAME)
clean:
	rm -rf $(OBJ_DIR)/*.o
	rm -rf $(TARGET)